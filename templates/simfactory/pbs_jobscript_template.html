{% autoescape off %}#!/bin/bash
#
# ******** Generated by Teakwood *********
#
# job name (default is name of pbs script file)
#PBS -N {{ job.name }}
#
# resource limits: number of CPUs to be used
#PBS -l nodes={{ job.nodes }}:ppn={{ job.machine.ppn }}
#
# resource limits: max. wall clock time during which job can be running
#PBS -l walltime={{ job.wallclocktimestring }}
#
# path/filename for standard output
#PBS -o {{ job.machine.workingdirectory }}/{{ job.name }}/{{ job.name }}.out
#
# path/filename for standard error
#PBS -e {{ job.machine.workingdirectory }}/{{ job.name }}/{{ job.name }}.err
#
# queue name, one of {default, special express}
#PBS -q {{ job.queuename }}
#
{% if job.accountingid %}
# group account (for example, g12345) to be charged
#PBS -A {{ job.accountingid }}
{% endif %}
# export all my environment variables to the job
#PBS -V
#
# send me mail when job begins
{% if job.emailonstarted %}
#PBS -m b{% if job.emailonterminated %}ea{% endif %}
#PBS -M {{ job.user.email }}
{% endif %}

export WORK_DIR={{ job.machine.workingdirectory }}/{{ job.name }}
cd $WORK_DIR
export NPROCS={{ job.slots }}

{#TODO need to fix both FVCOM and DELFT3D and prepare for ADCIRC and SWAN #}
# special treatment for FVCOM
{% if job.model_input.model.name == "FVCOM" %}
export CASE_NAME={{ job.model_input.fvcom_config.case_name }}
{% endif %}
# special treatment for ADCIRC
{% if job.model_input.model.name == "ADCIRC" %}
    {% if job.model_input.adcirc_config.swan %}
export SWAN=true
    {% else %}
export SWAN=false
    {% endif %}
{% endif %}
# special treatment for dependent runs
{% if job.model_input.model.name == "Delft3D" and job.model_input.delft3d_config.nested_model %}
export OVERALL_RUNID={{ job.model_input.delft3d_config.prior_runid }}
export NESTED_RUNID={{ job.model_input.delft3d_config.nested_runid }}
export A0_CORRECTION={{ job.model_input.delft3d_config.a0_correction }}
{{ job.script_template.native_script }}
{% else %}
# preprocessor
{{ job.script_template.preprocessor }}
# run the executable
{{ job.script_template.cmd_line }}
# postprocessor
{{ job.script_template.postprocessor }}
{% endif %}
{% endautoescape %}
